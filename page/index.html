<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OpenLexicon</title>
    <meta name="theme-color" content="#6750A4">

    <!-- Material Design 3 Web Components -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Symbols+Outlined" rel="stylesheet">
    <link rel="stylesheet" href="../css/global.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdui@2.0.3/mdui.min.css">
    <script src="https://cdn.jsdelivr.net/npm/mdui@2.0.3/mdui.min.js"></script>
    <link rel="stylesheet" href="../css/output.css">
</head>

<body class="mdui-theme-primary-blue">
    <div class="main-container">
        <!-- Welcome Screen -->
        <div id="welcomeScreen" class="welcome-card">
            <div class="hero-section">
                <img src="../openLexicon.png" alt="OpenLexicon" class="app-icon">
                <h1 class="app-title">OpenLexicon</h1>
                <p class="app-subtitle">Your personal vocabulary builder</p>
            </div>

            <div class="button-container">
<button id="resumeBtn" class="mdui-button mdui-color-blue-500 mdui-ripple px-4 py-2 text-white rounded shadow" disabled>
    <span class="material-symbols-outlined">history</span>
    Resume Last Session
</button>

<button id="openWordbankBtn" class="mdui-button mdui-ripple px-4 py-2 text-blue-500 border border-blue-500 rounded shadow" >
    <span class="material-symbols-outlined">folder_open</span>
    Open Wordbank
</button>
            </div>

            <div class="progress-container">
                <div id="loadingProgress" class="md3-progress">
                    <div class="md3-progress-bar"></div>
                </div>
            </div>
        </div>

        <!-- File Info Screen -->
        <div id="fileInfoScreen" class="file-info-card hidden">
            <div class="file-info-section">
                <h2 class="section-title">Wordbank Loaded</h2>
                <p>Successfully loaded your wordbank file:</p>
                <div class="file-path-container">
                    <div id="filePath" class="file-path"></div>
                </div>
            </div>

            <div class="button-row">
<button class="mdui-button mdui-color-blue-500 mdui-ripple px-4 py-2 text-white rounded shadow">
    <span class="material-symbols-outlined">play_arrow</span>
    Start Learning
</button>
<button class="mdui-button mdui-ripple px-4 py-2 text-blue-500 border border-blue-500 rounded shadow" onclick="openNewWordbank()">
    <span class="material-symbols-outlined">folder_open</span>
    Open Different File
</button>
            </div>
        </div>
    </div>

    <script>
        const { ipcRenderer } = require('electron');

        let fileLoader = null;

        // DOM elements
        const welcomeScreen = document.getElementById('welcomeScreen');
        const fileInfoScreen = document.getElementById('fileInfoScreen');
        const openWordbankBtn = document.getElementById('openWordbankBtn');
        const resumeBtn = document.getElementById('resumeBtn');
        const loadingProgress = document.getElementById('loadingProgress');
        const filePath = document.getElementById('filePath');

        // Initialize the app
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('OpenLexicon is ready!');

            // Check if there's a previous wordbank
            await checkPreviousWordbank();

            // Set up button click handlers
            setupEventHandlers();
        });

        function setupEventHandlers() {
            openWordbankBtn.addEventListener('click', () => {
                ipcRenderer.send('open-wordbank');
            });

            resumeBtn.addEventListener('click', () => {
                ipcRenderer.send('resume-wordbank');
            });
        }

        async function checkPreviousWordbank() {
            // Request to check if there's a previous wordbank
            ipcRenderer.send('check-previous-wordbank');
        }

        function showLoading() {
            loadingProgress.classList.add('visible');
            openWordbankBtn.disabled = true;
            resumeBtn.disabled = true;
        }

        function hideLoading() {
            loadingProgress.classList.remove('visible');
            openWordbankBtn.disabled = false;
        }

        function showFileInfo(filePath) {
            document.getElementById('filePath').textContent = filePath;
            welcomeScreen.classList.add('hidden');
            fileInfoScreen.classList.remove('hidden');
        }

        function showWelcomeScreen() {
            welcomeScreen.classList.remove('hidden');
            fileInfoScreen.classList.add('hidden');
            hideLoading();
        }

        function openNewWordbank() {
            showWelcomeScreen();
            ipcRenderer.send('open-wordbank');
        }

        // IPC Event Handlers
        ipcRenderer.on('wordbank-selected', (event, filePath) => {
            console.log('Wordbank selected:', filePath);
            hideLoading();
            showFileInfo(filePath);
        });

        ipcRenderer.on('no-previous-wordbank', () => {
            console.log('No previous wordbank found');
            resumeBtn.disabled = true;
            resumeBtn.innerHTML = '<span class="material-symbols-outlined">block</span>No Previous Session';
        });

        ipcRenderer.on('previous-wordbank-available', () => {
            console.log('Previous wordbank is available');
            resumeBtn.disabled = false;
        });

        ipcRenderer.on('wordbank-error', (event, error) => {
            console.error('Wordbank error:', error);
            hideLoading();
            // You could add a snackbar or dialog here to show the error
        });

        // Legacy file selection handler (keeping for compatibility)
        ipcRenderer.on('file-selected', (event, filePath) => {
            console.log('File selected:', filePath);
            hideLoading();
            showFileInfo(filePath);
        });
    </script>
</body>

</html>
